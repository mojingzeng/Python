### 企业网络规划

#### 一、了解用户需求：用户需求是设计网络的基础

1. 用户业务需求分析
2. 网络性能需求分析
3. 网络结构需求分析
4. 网络安全需求分析
5. 玩咯可靠性需求分析

#### 二、掌握现有建筑物分布

1. 建筑物的物理位置分布；

2. 逻辑需求分布；
3. 

#### 三、建立企业信息点分布表



### 高可用性企业网络设计

- **技术要求**

  1. 采用三层网络架构，万兆核心交换机接入，汇聚层千兆/万兆上联到核心，千兆接入桌面
  2. 核心交换机负责连接所有的汇聚层交换机、防火墙、内网服务器
  3. 要求整个网络具有高可靠性的总体设计，采用的技术是相对成熟的技术

- **双核心**

  1. 互双核心互为冗余，避免单点故障保证核心网络的可靠性运行
  2. 运行 VRRP/HSRP和MSTP，2台核心交换机虚拟出一个网关IP地址，并且防止环路形成，提高可靠性。

- **出口设计**

  1. 防火墙透明模式，简单可靠
  2. 防火墙重点任务是完成过滤规则的安全访问控制，后面结合安全，可以增加 IPS 系统等；
  3. 在网络测试和性能分析或者防火墙故障时，直接把防火墙撤掉无需修改网络的逻辑结构，方便管理员的维护管理；

- **网络管理和运维**

  1. 采用旁路部署方式，不影响整个网络的整体结构；
  2. 设备万兆/千兆级产品，具有更强的性能
  3. 提高了安全性
  4. 便于管理

  ### 企业网络中交换机管理配置

  1. 交换机管理配置

  2. 将交换机的管理 IP 设置为一个管理 VLAN ，对应一个 IP子网进行管理。

  3. 交换机端口安全配置

     - 交换机端口安全；
       端口安全功能：通过报文的源MAC+源IP 或者仅源IP限定报文是否可以通过交换机的端口。

       通常可以静态设置特定的 MAC地址，静态 IP+MAC绑定，或者动态学习限定个数的 MAC地址来控制报文是否可以进入端口。
       只有源 MAC地址为端口安全地址表中配置或者配置绑定的 IP+MAC 地址，或者配置的仅 IP 绑定地址，或者学习到的 MAC 地址报文才可以进入交换机通信，其他报文将被丢弃。

     - 端口安全违例处理；

       1. protect ： 当安全地址个数满后，安全端口将丢弃未知名地址（不是该端口的安全地址中的任何一个）的包

       2. restrict：当违例产生时，将发送一个 Trap通知；

       3. shutdown：当违例产生时，将关闭端口并发送一个Trap通知；

  4. **MSTP 原理**

     - MST(Multiple Spanning Tree) 特点：
       可以把多台交换机虚拟成一个MST 域，该 MST 域类似 CST 的一个桥，和 CST 桥互通；

       在 MST 域内，可以把具有相同拓扑的多个 vlan 映射到一个生成树实例，即 MSTI(Multiple Spanning Tree Instance);每个 MSTI 在域内可以又不同的拓扑，实现流量均衡的目的。

     - **MST**配置：
       - SA(config)#spanning-tree    !生成生成树
       - SA(config)#spanning-tree mode mstp  !采用 MSTP 生成树模式
       - SA(config)#vlan 10
       - SA(config)#vlan 20
       - SA(config)#vlan 40
       - SA(config)#interface fastethernet 0/1
       - SA(config-if)# switchport mode trunk
       - SA(config)#interface fastethernet 0/23
       - SA(config-if)#switchport mode trunk
       - SA(config)#interface fastethernet 0/24
       - SA(config-if)#switchport mode trunk
       - SA(config)#spanning-tree mst 1 priority 4096    !配置交换机在instance 1 中的优先级为4096，缺省是 32768 ，值越小优先成为该instance中的root switch
       - SA(config)#spanning-tree mst configuration !进入MSTP配置模式
       - SA(config-mst)#instance 1 vlan 1,10    !配置实例1并关联vlan1和10
       - SA(config-mst)#instance2 vlan 20,40   !配置实例2并关联 vlan20 和40
       - SA(config-mst)#name region1    !配置域名为region1
       - SA(config-mst)#revision 1    ! 配置版本号

  5. **DHCP 与 DHCP-relay**

     - DHCP Relay 代理可以去掉在每个物理的网段都要有 DHCP 服务器的必要，它可以传递消息到不在同一物理子网的 DHCP 服务器，也可以将服务器的消息回传给不在同一物理子网的 DHCP 客户机

       

  6. **访问控制列表**

     - 标准访问控制列表；

     - 扩展访问控制列表

     - 基于时间访问控制列表

     - 自反访问控制列表

       - **自反访问列表( Reflexive Access Lists)**
         自动根据一个方向的访问控制列表参数，创建出一个反方向的控制列表。并且和原来的控制列表的 IP 的源地址和目的地址倒过来，源端口号和目的端口号完全相反的一个列表。

         通常还有一定的时间限制，过了时间，就会超时，这个自反访问控制列表就会消失。

       - **特点**
         自反列表是一种临时性条目，而且没有默认的”拒绝一切“的语句

       - **基本特点**

         1.  总是允许语句；
         2. 指定与最初的外出数据包享通的协议( TCP );
         3.  指定与最初外出数据包相同的源地址和目的地址，但是这两个地址的  位置被互换；
         4.  指定与最初外出数据包相同的源和目的端口号码( 对 TCP/UDP ), 但这两个地址的位置被互换；
         5.  流入数据将根据自反条目的规则评判，直到该条目过期；
         6.  自反 ACL 只能在命名的扩展 ACL 里定义； 

  #### 企业网络 NAT 配置

  1. NAT 基本配置
     - **静态 NAT**
       静态 NAT 将合法 IP 地址和内部 IP 地址进行绑定，这种绑定的好处就是外网可以访问内网主机，内网可以访问外网。
  2. 服务器地址静态映射
  3. 内网主机共享地址上网

  

  